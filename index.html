<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nav67 TV Dashboard</title>
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <style>
        body { background: #121212; color: #eee; font-family: sans-serif; margin: 0; padding-bottom: 30px; }
        .vjs-container { position: sticky; top: 0; z-index: 100; background: #000; width: 100%; }
        .video-js { width: 100% !important; height: 230px !important; }
        .search-bar { padding: 10px; background: #1f1f1f; }
        #search { width: 100%; padding: 10px; border-radius: 5px; border: none; box-sizing: border-box; background: #333; color: white; }
        .chan-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; }
        .card { background: #252525; border: 1px solid #333; border-radius: 10px; padding: 15px; text-align: center; font-size: 13px; cursor: pointer; transition: 0.2s; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card:active { background: #ff9800; color: #000; }
        .group-tag { font-size: 10px; color: #ff9800; display: block; margin-bottom: 5px; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="vjs-container">
    <video id="tv-player" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" playsinline></video>
</div>

<div class="search-bar">
    <input type="text" id="search" placeholder="Cari channel (contoh: Moji, Sky, Astro)...">
</div>

<div class="chan-grid" id="chan-list">
    </div>

<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-contrib-dash/dist/videojs-dash.min.js"></script>

<script>
    const player = videojs('tv-player');
    const m3uUrl = 'https://github.com/maulanaisna/NontonTV/raw/refs/heads/main/playlist%20iptv%20nav67.m3u';
    let allChannels = [];

    async function init() {
        const res = await fetch(m3uUrl);
        const text = await res.text();
        const lines = text.split('\n');
        
        let currentChan = {};
        lines.forEach(line => {
            if (line.startsWith('#EXTINF')) {
                const name = line.split(',')[1] || "Unknown";
                const groupMatch = line.match(/group-title="([^"]+)"/);
                currentChan = { name: name.trim(), group: groupMatch ? groupMatch[1] : "Lainnya" };
            } else if (line.startsWith('http')) {
                currentChan.url = line.trim();
                allChannels.push(currentChan);
                currentChan = {};
            }
        });
        render(allChannels);
    }

    function render(channels) {
        const container = document.getElementById('chan-list');
        container.innerHTML = '';
        channels.forEach(ch => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `<span class="group-tag">${ch.group}</span>${ch.name}`;
            div.onclick = () => {
                player.src({ src: ch.url, type: ch.url.includes('.mpd') ? 'application/dash+xml' : 'application/x-mpegURL' });
                player.play();
                window.scrollTo({top: 0, behavior: 'smooth'});
            };
            container.appendChild(div);
        });
    }

    document.getElementById('search').oninput = (e) => {
        const filtered = allChannels.filter(c => c.name.toLowerCase().includes(e.target.value.toLowerCase()));
        render(filtered);
    };

    init();
</script>
</body>
</html>